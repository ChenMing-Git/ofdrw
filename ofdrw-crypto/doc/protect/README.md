# OFD完整性保护协议

由于OFD是一个ZIP文件，从技术机制上可以包含各种文件。如果一个OFD文件包内的文件，
其在按照“OFD.xml”“Encryptions.xml”及其衍生文件充分遍历后，仍未被任何其他文件引用，
这就属于“夹带文件”。 ——《GM/T 0099-2020》 附录D 总体说明

OFD的完整性保护信息使用XML文件描述。完整性保护文件中应记录OFD文件内与文件内容相关的
所有包内文件。
应对完整性保护文件实现 **带有时间戳的数字签名**。——《GM/T 0099-2020》7.4.2 数据格式要求

> 签名值应符合“GB/T 35275”标准

完整性保护协议：

1. 把所有OFD内容所有相关联的文件，放入一个“清单”，也就是 完整性保护文件。
2. 对 完整性保护文件 实行 带有时间戳的数字签名。
3. 把 完整性保护文件 和 数字签名 放入OFD包内，打包。

![防止夹带](../img/防止夹带.png)

验证：

1. 验证签名是否正确
2. 验证时就是遍历所有文件，如果有文件不在 完整性保护文件 列表中，认为是夹带。